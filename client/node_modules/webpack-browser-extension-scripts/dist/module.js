"use strict";var w=Object.create;var m=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var F=Object.getOwnPropertyNames;var W=Object.getPrototypeOf,D=Object.prototype.hasOwnProperty;var _=(e,t)=>{for(var s in t)m(e,s,{get:t[s],enumerable:!0})},L=(e,t,s,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of F(t))!D.call(e,i)&&i!==s&&m(e,i,{get:()=>t[i],enumerable:!(n=S(t,i))||n.enumerable});return e};var p=(e,t,s)=>(s=e!=null?w(W(e)):{},L(t||!e||!e.__esModule?m(s,"default",{value:e,enumerable:!0}):s,e)),R=e=>L(m({},"__esModule",{value:!0}),e);var H={};_(H,{default:()=>x});module.exports=R(H);var I=p(require("path"));var E=p(require("browser-extension-manifest-fields"));var f=p(require("path")),y=p(require("fs"));function A(e,t){return t.some(s=>e.includes(s))}function C(e,t){let s=f.default.relative(f.default.dirname(e),t);return!s.startsWith(".")&&!s.startsWith("..")&&(s="./"+s),s}function h(e,t,s){return(Array.isArray(t)?t||[]:t?[t]:[]).filter(r=>{let o=y.default.existsSync(r)&&!A(r,s),a=e.options.resolve?.extensions||[".js",".mjs"],c=f.default.extname(r);return o&&a.includes(c)})}function g(e,t){return(Array.isArray(e)?e||[]:e?[e]:[]).filter(i=>y.default.existsSync(i)&&!A(i,t)&&i.endsWith(".css")||i.endsWith(".scss")||i.endsWith(".sass")||i.endsWith(".less"))}var l=class{manifestPath;includeList;exclude;constructor(t){this.manifestPath=t.manifestPath,this.includeList=t.includeList,this.exclude=t.exclude}apply(t){let s={...(0,E.default)(this.manifestPath).scripts,...this.includeList};for(let n of Object.entries(s)){let[i,r]=n,o=h(t,r,this.exclude),a=g(r,this.exclude),c=[...o];t.options.mode==="production"&&c.push(...a),(a.length||o.length)&&(t.options.entry={...t.options.entry,[i]:{import:c}})}}};var P=p(require("path")),k=p(require("browser-extension-manifest-fields"));var u=class{manifestPath;includeList;exclude;constructor(t){this.manifestPath=t.manifestPath,this.includeList=t.includeList,this.exclude=t.exclude}apply(t){let s=(0,k.default)(this.manifestPath).scripts,n=[],i=Object.entries(s).filter(([r,o])=>r.startsWith("content")&&o);if(i.length){for(let r of i){let[o,a]=r,c=[...h(t,a,this.exclude)],v=g(a,this.exclude);if(v.length&&!c.length){let d=P.default.resolve(__dirname,"minimum-content-file.mjs");t.options.entry={...t.options.entry,[o]:{import:[d]}},c.push(d)}n.push({feature:o,scriptPath:c[0],cssImports:v.map(d=>C(c[0],d))})}t.options.module.rules.push({test:/\.(m?j(sx?|sx?)?|m?t(sx?|sx?))$/,use:[{loader:P.default.resolve(__dirname,"./loaders/InjectDynamicCssLoader"),options:{manifestPath:this.manifestPath,cssImportPaths:n}}]})}}};var j=p(require("path"));function b(e,t){e.options.module.rules.push({test:/\.(t|j)sx?$/,use:[{loader:j.default.resolve(__dirname,"./loaders/InjectHMRAcceptLoader"),options:{manifestPath:t}}]})}var x=class{manifestPath;include;exclude;constructor(t){this.manifestPath=t.manifestPath,this.include=t.include||[],this.exclude=t.exclude||[]}parseIncludes(t){return t.length?t.reduce((s,n)=>{let i=I.default.extname(n),r=I.default.basename(n,i);return{...s,[`scripts/${r}`]:n}},{}):{}}apply(t){new l({manifestPath:this.manifestPath,includeList:this.parseIncludes(this.include||[]),exclude:this.exclude||[]}).apply(t),t.options.mode==="development"&&new u({manifestPath:this.manifestPath,includeList:this.parseIncludes(this.include||[]),exclude:this.exclude||[]}).apply(t),b(t,this.manifestPath)}};
