"use strict";var E=Object.create;var u=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var P=Object.getPrototypeOf,C=Object.prototype.hasOwnProperty;var _=(e,s)=>{for(var t in s)u(e,t,{get:s[t],enumerable:!0})},y=(e,s,t,r)=>{if(s&&typeof s=="object"||typeof s=="function")for(let n of M(s))!C.call(e,n)&&n!==t&&u(e,n,{get:()=>s[n],enumerable:!(r=k(s,n))||r.enumerable});return e};var l=(e,s,t)=>(t=e!=null?E(P(e)):{},y(s||!e||!e.__esModule?u(t,"default",{value:e,enumerable:!0}):t,e)),F=e=>y(u({},"__esModule",{value:!0}),e);var T={};_(T,{default:()=>p});module.exports=F(T);var d=l(require("fs")),f=require("webpack"),j=l(require("browser-extension-manifest-fields"));var b=l(require("path"));function O(e,s){return s.some(t=>e.includes(t))}function D(e){switch(b.default.extname(e)){case".js":case".mjs":case".ts":case".tsx":return".js";case".css":case".scss":case".sass":case".less":return".css";case".html":return".html";default:return".js"}}function J(e,s){if(e.getAsset("manifest.json")){let t=e.assets["manifest.json"].source().toString();return JSON.parse(t||"{}")}return require(s)}var S={shouldExclude:O,getExtname:D,getManifestContent:J};var m=l(require("webpack"));function N(e){let s="A manifest file is required for this plugin to run.";e.errors.push(new m.default.WebpackError(`[manifest.json]: ${s}`))}function $(e,s,t){let r=`Check the \`${s}\` field in your \`manifest.json\` file.`,n=`File path \`${t}\` not found. ${r}`;e.warnings.push(new m.default.WebpackError(`[manifest.json]: ${n}`))}function I(e){let r="Default locale was specified, but `_locales` subtree is missing. Ensure the `_locales` folder is valid and available at the root of your project. or remove the `default_locale` field from your `manifest.json` file.";e.errors.push(new m.default.WebpackError(`[_locales]: ${r}`))}var A={manifestNotFoundError:N,entryNotFoundWarn:$,noValidFolderError:I};var p=class{manifestPath;exclude;constructor(s){this.manifestPath=s.manifestPath,this.exclude=s.exclude}apply(s){s.hooks.thisCompilation.tap("JsonPlugin (module)",t=>{t.hooks.processAssets.tap({name:"JsonPlugin (module)",stage:f.Compilation.PROCESS_ASSETS_STAGE_ADDITIONS},r=>{if(t.errors.length>0)return;let n=r["manifest.json"]?JSON.parse(r["manifest.json"].source().toString()):require(this.manifestPath),h=(0,j.default)(this.manifestPath,n).json;for(let g of Object.entries(h)){let[a,c]=g,o=Array.isArray(c)?c:[c];for(let i of o)if(i&&!S.shouldExclude(i,this.exclude||[])){if(!d.default.existsSync(i)){A.entryNotFoundWarn(t,a,i);return}let x=d.default.readFileSync(i),w=new f.sources.RawSource(x);t.emitAsset(a+".json",w)}}})}),s.hooks.thisCompilation.tap("JsonPlugin (module)",t=>{t.hooks.processAssets.tap({name:"JsonPlugin (module)",stage:f.Compilation.PROCESS_ASSETS_STAGE_ADDITIONS},r=>{if(t.errors?.length)return;let n=r["manifest.json"]?JSON.parse(r["manifest.json"].source().toString()):require(this.manifestPath),h=(0,j.default)(this.manifestPath,n).json;for(let g of Object.entries(h)){let[,a]=g,c=Array.isArray(a)?a:[a];for(let o of c)if(o){let i=new Set(t.fileDependencies);S.shouldExclude(o,this.exclude||[])||d.default.existsSync(o)&&(i.has(o)||(i.add(o),t.fileDependencies.add(o)))}}})})}};
