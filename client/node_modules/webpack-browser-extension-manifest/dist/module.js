"use strict";var wt=Object.create;var E=Object.defineProperty;var kt=Object.getOwnPropertyDescriptor;var Et=Object.getOwnPropertyNames;var vt=Object.getPrototypeOf,Ft=Object.prototype.hasOwnProperty;var Pt=(t,e)=>{for(var r in e)E(t,r,{get:e[r],enumerable:!0})},nt=(t,e,r,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let p of Et(e))!Ft.call(t,p)&&p!==r&&E(t,p,{get:()=>e[p],enumerable:!(s=kt(e,p))||s.enumerable});return t};var l=(t,e,r)=>(r=t!=null?wt(vt(t)):{},nt(e||!t||!t.__esModule?E(r,"default",{value:t,enumerable:!0}):r,t)),St=t=>nt(E({},"__esModule",{value:!0}),t);var Dt={};Pt(Dt,{default:()=>x});module.exports=St(Dt);var v=l(require("fs")),ot=require("webpack");var m=l(require("fs")),O=l(require("webpack")),h=l(require("browser-extension-manifest-fields"));function xt(){return`[manifest.json] Entry Point Modification Found.

Changing the path of non-static assets defined in manifest.json requires a server restart. To apply these changes, restart the program and try again.`}function jt(t,e){let r=`Check the \`${t.replace("/",".")}\` field in your manifest.json file and try again.`;return`[manifest.json] File path \`${e}\` not found. ${r}`}function Ct(){return"A manifest file is required. Ensure you have a manifest.json file at the root direcotry of your project."}function At(t){return`${t}. Update your manifest file and run the program again.`}var c={serverRestartRequired:xt,manifestFieldError:jt,manifestNotFoundError:Ct,manifestInvalidError:At};function Ot(t){t.errors.push(new O.default.WebpackError(`[manifest.json]: ${c.manifestNotFoundError}`))}function $t(t,e){t.errors.push(new O.default.WebpackError(`[manifest.json]: ${c.manifestInvalidError}`))}function Rt(t,e,r){let s=require(e),p=(0,h.default)(e,s).html;for(let[a,i]of Object.entries(p))if(i){let o=c.manifestFieldError(a,i?.html);m.default.existsSync(i.html)||t.errors.push(new r(o))}}function qt(t,e,r){let s=require(e),p=(0,h.default)(e,s).icons;for(let[a,i]of Object.entries(p)){if(i&&typeof i=="string"){let o=c.manifestFieldError(a,i);m.default.existsSync(i)||t.errors.push(new r(o))}if(i!=null&&i.constructor.name==="Object"){let o=i;if(o.light){let f=c.manifestFieldError(a,o.light);m.default.existsSync(o.dark)||t.errors.push(new r(f))}if(o.dark){let f=c.manifestFieldError(a,o.dark);m.default.existsSync(o.dark)||t.errors.push(new r(f))}}if(Array.isArray(i))for(let o of i){let f=c.manifestFieldError(a,o);typeof o=="string"&&(m.default.existsSync(o)||t.errors.push(new r(f)))}}}function Nt(t,e,r){let s=require(e),p=(0,h.default)(e,s).json;for(let[a,i]of Object.entries(p))if(i){let o=Array.isArray(i)?i:[i];for(let f of o){let u=c.manifestFieldError(a,f);m.default.existsSync(f)||t.errors.push(new r(u))}}}function It(t,e,r){let s=require(e),p=(0,h.default)(e,s).scripts;for(let[a,i]of Object.entries(p))if(i){let o=Array.isArray(i)?i:[i];for(let f of o)if(a.startsWith("content_scripts")){let[u,j]=a.split("-"),C=`${u} (index ${j})`,A=c.manifestFieldError(C,f);m.default.existsSync(f)||t.errors.push(new r(A))}else{let u=c.manifestFieldError(a,f);m.default.existsSync(f)||t.errors.push(new r(u))}}}var $={manifestNotFoundError:Ot,manifestInvalidError:$t,handleHtmlErrors:Rt,handleIconsErrors:qt,handleJsonErrors:Nt,handleScriptsErrors:It};var _=class{options;constructor(e){this.options=e}apply(e){e.hooks.thisCompilation.tap("ManifestPlugin (EmitManifestPlugin)",r=>{r.hooks.seal.tap("ManifestPlugin (EmitManifestPlugin)",()=>{if(!v.default.existsSync(this.options.manifestPath)){$.manifestNotFoundError(r);return}try{JSON.parse(v.default.readFileSync(this.options.manifestPath).toString())}catch(i){$.manifestInvalidError(r,i);return}if(r.errors.length>0)return;let s="manifest.json",p=v.default.readFileSync(this.options.manifestPath),a=new ot.sources.RawSource(p);r.emitAsset(s,a)})})}};var P=require("webpack");var ht=l(require("path"));var R=l(require("path"));function Jt(t,e){return e.some(r=>t.includes(r))}function Bt(t,e){if(t.getAsset("manifest.json")||t.assets["manifest.json"]){let r=t.assets["manifest.json"].source().toString();return JSON.parse(r||"{}")}return require(e)}var d={shouldExclude:Jt,getManifestContent:Bt};function n(t,e,r){let s=R.default.extname(e),a=d.shouldExclude(e,r)?R.default.normalize(e):t;return[".js",".jsx",".tsx",".ts"].includes(s)?a.replace(s,".js"):[".html",".njk",".nunjucks"].includes(s)?a.replace(s,".html"):[".css",".scss",".sass",".less"].includes(s)?a.replace(s,".css"):a}function q(t,e){return t.background&&t.background.page&&{background:{...t.background,...t.background.page&&{page:n("background/page.html",t.background.page,e)}}}}function N(t,e){return t.chrome_url_overrides&&{chrome_url_overrides:{...t.chrome_url_overrides.bookmarks&&{bookmarks:n("chrome_url_overrides/bookmarks.html",t.chrome_url_overrides.bookmarks,e)},...t.chrome_url_overrides.history&&{history:n("chrome_url_overrides/history.html",t.chrome_url_overrides.history,e)},...t.chrome_url_overrides.newtab&&{newtab:n("chrome_url_overrides/newtab.html",t.chrome_url_overrides.newtab,e)}}}}function I(t,e){return t.content_scripts&&{content_scripts:t.content_scripts.map((r,s)=>{let p=[...new Set(r.js)],a=[...new Set(r.css)];return{...r,js:[...p.map(i=>n(`content_scripts/content-${s}.js`,i,e))],css:[...a.map(i=>n(`content_scripts/content-${s}.css`,i,e))]}})}}function J(t,e){return t.devtools_page&&{devtools_page:n("devtools_page.html",t.devtools_page,e)}}var at=l(require("path"));var Tt=t=>at.default.basename(t);function B(t,e){return t.icons&&{icons:Object.fromEntries(Object.entries(t.icons).map(([r,s])=>[r,n(`icons/${Tt(s)}`,s,e)]))}}function T(t,e){return t.options_page&&{options_page:n("options_ui/page.html",t.options_page,e)}}function V(t,e){return t.options_ui&&{options_ui:{...t.options_ui,...t.options_ui.page&&{page:n("options_ui/page.html",t.options_ui.page,e)}}}}var ft=l(require("path"));var pt=t=>ft.default.basename(t);function U(t,e){return t.page_action&&{page_action:{...t.page_action,...t.page_action.default_popup&&{default_popup:n("page_action/default_popup.html",t.page_action.default_popup,e)},...t.page_action.default_icon&&{default_icon:typeof t.page_action.default_icon=="string"?n(`page_action/${pt(t.page_action.default_icon)}`,t.page_action.default_icon,e):Object.fromEntries(Object.entries(t.page_action.default_icon).map(([r,s])=>[r,n(`page_action/${pt(s)}`,s,e)]))}}}}function W(t,e){return t.sandbox&&{sandbox:{...t.sandbox,...t.sandbox.pages&&{pages:t.sandbox.pages.map((r,s)=>n(`sandbox/page-${s}.html`,r,e))}}}}function b(t,e){return t.side_panel&&{side_panel:{...t.side_panel.default_path&&{default_path:n("side_panel/default_path.html",t.side_panel.default_path,e)}}}}var ct=l(require("path"));var Vt=t=>ct.default.basename(t);function D(t,e){return t.sidebar_action&&{sidebar_action:{...t.sidebar_action,...t.sidebar_action.default_panel&&{default_panel:n("sidebar_action/default_panel.html",t.sidebar_action.default_panel,e)},...t.sidebar_action.default_icon&&{default_icon:n(`sidebar_action/${Vt(t.sidebar_action.default_icon)}`,t.sidebar_action.default_icon,e)}}}}function L(t,e){return t.storage&&{storage:{...t.storage.managed_schema&&{managed_schema:n("storage/managed_schema.json",t.storage.managed_schema,e)}}}}var lt=l(require("path"));var Ut=t=>lt.default.basename(t);function H(t,e){return t.theme&&{theme:{...t.theme,...t.theme.images&&{images:{...t.theme.images,theme_frame:n(`theme/images/${Ut(t.theme.images.theme_frame)}`,t.theme.images.theme_frame,e)}}}}}function G(t,e){return t.user_scripts&&{user_scripts:{...t.user_scripts,...t.user_scripts.api_script&&{api_script:n("user_scripts/api_script.js",t.user_scripts.api_script,e)}}}}function Z(t,e){return t.web_accessible_resources&&t.web_accessible_resources.length&&{web_accessible_resources:t.web_accessible_resources}}function Wt(t,e){return{...q(t,e),...N(t,e),...I(t,e),...J(t,e),...B(t,e),...T(t,e),...V(t,e),...U(t,e),...W(t,e),...b(t,e),...D(t,e),...L(t,e),...H(t,e),...G(t,e),...Z(t,e)}}var ut=Wt;function z(t,e){return t.background&&t.background.scripts&&{background:{...t.background,...t.background.scripts&&{scripts:["background/scripts.js",...t.background.scripts.filter(r=>d.shouldExclude(r,e))]}}}}var mt=l(require("path"));var F=t=>mt.default.basename(t);function Y(t,e){return t.browser_action&&{browser_action:{...t.browser_action,...t.browser_action.default_popup&&{default_popup:n("browser_action/default_popup.html",t.browser_action.default_popup,e)},...t.browser_action.default_icon&&{default_icon:typeof t.browser_action.default_icon=="string"?n(`browser_action/${F(t.browser_action.default_icon)}`,t.browser_action.default_icon,e):Object.fromEntries(Object.entries(t.browser_action.default_icon).map(([r,s])=>[r,n(`browser_action/${F(s)}`,s,e)]))},...t.browser_action.theme_icons&&{theme_icons:t.browser_action.theme_icons.map(r=>({...r,...r.light&&{light:n(`browser_action/${F(r.light)}`,r.light,e)},...r.dark&&{dark:n(`browser_action/${F(r.dark)}`,r.dark,e)}}))}}}}function K(t,e){return t.declarative_net_request&&{declarative_net_request:{...t.declarative_net_request,rule_resources:t.declarative_net_request.rule_resources.map(r=>({...r,path:r.path&&n(`declarative_net_request/${r.id}.json`,r.path,e)}))}}}function Q(t,e){return{...z(t,e),...Y(t,e),...K(t,e)}}var gt=l(require("path"));var dt=t=>gt.default.basename(t);function X(t,e){return t.action&&{action:{...t.action,...t.action.default_popup&&{default_popup:n("action/default_popup.html",t.action.default_popup,e)},...t.action.default_icon&&{default_icon:typeof t.action.default_icon=="string"?n(`action/${dt(t.action.default_icon)}`,t.action.default_icon,e):Object.fromEntries(Object.entries(t.action.default_icon).map(([r,s])=>[r,n(`action/${dt(s)}`,s,e)]))}}}}function tt(t,e){return t.background&&t.background.service_worker&&{background:{...t.background,...t.background.service_worker&&{service_worker:n("background/service_worker.js",t.background.service_worker,e)}}}}function et(t,e){return{...X(t,e),...tt(t,e),...b(t,e)}}function rt(t,e,r=[]){let s=e||require(t),p=r.map(a=>{let i=ht.default.dirname(t),o=a.replace(i,"");return o.startsWith("/")?o.slice(1):o});return JSON.stringify({...s,...ut(s,p),...Q(s,p),...et(s,p)},null,2)}var y=class{manifestPath;exclude;constructor(e){this.manifestPath=e.manifestPath,this.exclude=e.exclude}applyDevOverrides(e){return e.content_scripts?e.content_scripts.map((r,s)=>(r.css.length&&!r.js.length&&(r.js=[n(`content_scripts-${s}`,"dev.js",[])]),r)):{}}apply(e){e.hooks.thisCompilation.tap("ManifestPlugin (UpdateManifestPlugin)",r=>{r.hooks.processAssets.tap({name:"ManifestPlugin (UpdateManifestPlugin)",stage:P.Compilation.PROCESS_ASSETS_STAGE_SUMMARIZE},()=>{if(r.errors.length>0)return;let s=r.getAsset("manifest.json")?.source.source(),p=JSON.parse((s||"").toString()),a=rt(this.manifestPath,p,this.exclude),i={...p,...JSON.parse(a)};e.options.mode!=="production"&&i.content_scripts&&(i.content_scripts=this.applyDevOverrides(i));let o=JSON.stringify(i,null,2),f=new P.sources.RawSource(o);r.updateAsset("manifest.json",f)})})}};var _t=l(require("fs")),M=class{dependencyList;constructor(e){this.dependencyList=e}apply(e){e.hooks.afterCompile.tap("ManifestPlugin (AddDependenciesPlugin)",r=>{if(r.errors?.length)return;let s=new Set(r.fileDependencies);this.dependencyList&&this.dependencyList.forEach(p=>{_t.default.existsSync(p)&&(s.has(p)||(s.add(p),r.fileDependencies.add(p)))})})}};var g=l(require("fs")),S=l(require("webpack")),w=l(require("browser-extension-manifest-fields"));var st=class{manifestPath;constructor(e){this.manifestPath=e.manifestPath}handleHtmlErrors(e,r){let s=d.getManifestContent(e,this.manifestPath),p=(0,w.default)(this.manifestPath,s).html;for(let[a,i]of Object.entries(p))if(i){let o=c.manifestFieldError(a,i?.html);g.default.existsSync(i.html)||e.errors.push(new r(o))}}handleIconsErrors(e,r){let s=d.getManifestContent(e,this.manifestPath),p=(0,w.default)(this.manifestPath,s).icons;for(let[a,i]of Object.entries(p)){if(i&&typeof i=="string"){let o=c.manifestFieldError(a,i);g.default.existsSync(i)||e.warnings.push(new r(o))}if(i!=null&&i.constructor.name==="Object"){let o=i;if(o.light){let f=c.manifestFieldError(a,o.light);g.default.existsSync(o.dark)||e.warnings.push(new r(f))}if(o.dark){let f=c.manifestFieldError(a,o.dark);g.default.existsSync(o.dark)||e.warnings.push(new r(f))}}if(Array.isArray(i))for(let o of i){let f=c.manifestFieldError(a,o);typeof o=="string"&&(g.default.existsSync(o)||e.warnings.push(new r(f)))}}}handleJsonErrors(e,r){let s=d.getManifestContent(e,this.manifestPath),p=(0,w.default)(this.manifestPath,s).json;for(let[a,i]of Object.entries(p))if(i){let o=c.manifestFieldError(a,i);g.default.existsSync(i)||e.warnings.push(new r(o))}}handleScriptsErrors(e,r){let s=d.getManifestContent(e,this.manifestPath),p=(0,w.default)(this.manifestPath,s).scripts;for(let[a,i]of Object.entries(p))if(i){let o=Array.isArray(i)?i:[i];for(let f of o)if(a.startsWith("content_scripts")){let[u,j]=a.split("-"),C=`${u} (index ${j})`,A=c.manifestFieldError(C,f);g.default.existsSync(f)||e.errors.push(new r(A))}else{let u=c.manifestFieldError(a,f);g.default.existsSync(f)||e.errors.push(new r(u))}}}apply(e){e.hooks.compilation.tap("ManifestPlugin (CheckManifestFilesPlugin)",r=>{r.hooks.processAssets.tap({name:"ManifestPlugin (CheckManifestFilesPlugin)",stage:S.Compilation.PROCESS_ASSETS_STAGE_OPTIMIZE_COMPATIBILITY},()=>{let s=S.default.WebpackError;this.handleHtmlErrors(r,s),this.handleIconsErrors(r,s),this.handleJsonErrors(r,s),this.handleScriptsErrors(r,s)})})}},bt=st;var yt=l(require("fs")),Mt=l(require("webpack")),it=l(require("browser-extension-manifest-fields"));var k=class{manifestPath;exclude;initialValues=[];constructor(e){this.manifestPath=e.manifestPath,this.exclude=e.exclude||[],this.initialValues=this.getFlattenedAssets(this.readManifest())}readManifest(){try{let e=yt.default.readFileSync(this.manifestPath,"utf-8");return JSON.parse(e)}catch(e){console.error("Error reading manifest file:",e);return}}getFlattenedAssets(e){let r=(0,it.default)(this.manifestPath,e).html,s=(0,it.default)(this.manifestPath,e).scripts,p=Object.values(r).map(o=>o?.html),a=Object.values(s).flat();return[...p,...a].filter(o=>o!=null)}apply(e){e.hooks.watchRun.tapAsync("ManifestPlugin (ThrowIfRecompileIsNeeded)",(r,s)=>{if((r.modifiedFiles||new Set).has(this.manifestPath)){let a=this.readManifest(),i=this.getFlattenedAssets(a).sort();this.initialValues.sort().toString()!==i.toString()&&r.hooks.thisCompilation.tap("ManifestPlugin (ThrowIfRecompileIsNeeded)",f=>{let u=c.serverRestartRequired();f.errors.push(new Mt.default.WebpackError(u))})}s()})}};var x=class{browser;manifestPath;exclude;constructor(e){this.browser=e.browser,this.manifestPath=e.manifestPath,this.exclude=e.exclude}apply(e){new _({manifestPath:this.manifestPath}).apply(e),new bt({manifestPath:this.manifestPath}).apply(e),new y({manifestPath:this.manifestPath,exclude:this.exclude}).apply(e),new M([this.manifestPath]).apply(e),new k({manifestPath:this.manifestPath,exclude:this.exclude}).apply(e)}};
