"use strict";var V=Object.create;var l=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var H=Object.getPrototypeOf,K=Object.prototype.hasOwnProperty;var Q=(t,e)=>{for(var r in e)l(t,r,{get:e[r],enumerable:!0})},W=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of G(e))!K.call(t,n)&&n!==r&&l(t,n,{get:()=>e[n],enumerable:!(o=z(e,n))||o.enumerable});return t};var p=(t,e,r)=>(r=t!=null?V(H(t)):{},W(e||!t||!t.__esModule?l(r,"default",{value:t,enumerable:!0}):r,t)),X=t=>W(l({},"__esModule",{value:!0}),t);var it={};Q(it,{default:()=>st});module.exports=X(it);var q=p(require("path")),B=require("schema-utils"),F=p(require("@babel/parser"));var g=p(require("path")),m=p(require("fs"));function Y(t){let e=g.default.join(t,"package.json");if(!m.default.existsSync(e))return!1;let r=require(e),o=r.devDependencies&&r.devDependencies.typescript,n=r.dependencies&&r.dependencies.typescript;return!!(o||n)}function Z(t){let e=g.default.join(t,"package.json");if(!m.default.existsSync(e))return!1;let r=require(e),o=r.devDependencies&&r.devDependencies.react,n=r.dependencies&&r.dependencies.react;return!!(o||n)}var b={isUsingTypeScript:Y,isUsingReact:Z};var J=p(require("@babel/traverse")),T=p(require("@babel/generator"));function tt(t,e){let r=t;for(let o=e.length-1;o>=0;o--){if(o===0)return r.type==="Identifier"&&r.name===e[o];if(r.type!=="MemberExpression"||r.property.type!=="Identifier"||r.property.name!==e[o])return!1;r=r.object}return!0}function s(t,e){let r=e.split(".");return tt(t,r)}var u=p(require("@babel/types"));function d(t,e){if(t.node.arguments.length===0)return;let r=t.node.arguments[0];t.node.arguments[0]=u.callExpression(u.identifier(e),[r])}function P(t,e){if(t.node.arguments.length!==0){if(e==="chrome.devtools.panels.create"||e==="browser.devtools.panels.create")t.node.arguments[1]=u.callExpression(u.identifier("r.solve"),[t.node.arguments[1]]),t.node.arguments[2]=u.callExpression(u.identifier("r.solve"),[t.node.arguments[2]]);else if(e==="chrome.runtime.getURL"||e==="browser.runtime.getURL"){if(t.node.arguments[0].value&&t.node.arguments[0].value.includes("/_favicon/"))return;t.node.arguments[0]=u.callExpression(u.identifier("r.solve"),[t.node.arguments[0]])}}}function et(t,e,r,o){(s(t,`${o}.action.setIcon`)||s(t,`${o}.browserAction.setIcon`)||s(t,`${o}.pageAction.setIcon`)||s(t,`${o}.declarativeContent.SetIcon`)||s(t,`${o}.action.setPopup`)||s(t,`${o}.browserAction.setPopup`)||s(t,`${o}.pageAction.setPopup`)||s(t,`${o}.scriptBadge.setPopup`))&&d(r,"r.solve"),s(t,`${o}.devtools.panels.create`)&&P(r,`${o}.devtools.panels.create`),s(t,`${o}.downloads.download`)&&d(r,"r.solve"),s(t,`${o}.runtime.getURL`)&&P(r,`${o}.runtime.getURL`),(s(t,`${o}.scripting.insertCSS`)||s(t,`${o}.scripting.removeCSS`)||s(t,`${o}.scripting.executeScript`))&&d(r,"r.solve"),(s(t,`${o}.scripting.registerContentScripts`)||s(t,`${o}.declarativeContent.RequestContentScript`))&&d(r,"r.solve"),s(t,`${o}.declarativeContent.RequestContentScript`)&&d(r,"r.solve"),(s(t,`${o}.tabs.create`)||s(t,`${o}.tabs.executeScript`)||s(t,`${o}.tabs.insertCSS`)||s(t,`${o}.windows.create`))&&e.length>0&&d(r,"r.solve"),s(t,`${o}.sidePanel.setOptions`)&&d(r,"r.solve"),s(t,`${o}.notifications.create`)&&d(r,"r.solve")}function _(t,e){return(0,J.default)(t,{CallExpression(o){let n=["chrome","browser"],i=o.node.callee,a=o.node.arguments;n.forEach(c=>{et(i,a,o,c)})}}),(0,T.default)(t,{decoratorsBeforeExport:!1},e).code}var U=p(require("fs"));var R=p(require("path"));function h(t){if(!t||!t.background)return;let e=t.background.scripts;if(e)return e.map(r=>r)}function v(t){if(!t||!t.background)return;if(t.background.service_worker)return t.background.service_worker}function y(t){if(!t||!t.content_scripts)return{"content_scripts/content-0.js":void 0};let e=i=>{if(i.js?.length!==0)return i.js?.map(a=>a)},r=i=>{if(i.css?.length!==0)return i.css?.map(a=>a)},o={},n=t.content_scripts;for(let[i,a]of n.entries()){let c=e(a),N=r(a);o[`content_scripts/content-${i}`]=[...(c||[]).filter(f=>f!=null),...(N||[]).filter(f=>f!=null)]}return o}function x(t){return!t||!t.user_scripts||!t.user_scripts.api_script?void 0:t.user_scripts.api_script}function A(t){return!t||!t.action||!t.action.default_popup?void 0:t.action.default_popup}function D(t){return!t||!t.background||!t.background.page?void 0:t.background.page}function M(t){return!t||!t.browser_action||!t.browser_action.default_popup?void 0:t.browser_action.default_popup}function k(t){let e={newtab:void 0};return!t||!t.chrome_url_overrides?{"chrome_url_overrides/newtab.html":void 0}:(t.chrome_url_overrides.history&&(e={"chrome_url_overrides/history.html":t.chrome_url_overrides.history}),t.chrome_url_overrides.newtab&&(e={"chrome_url_overrides/newtab.html":t.chrome_url_overrides.newtab}),t.chrome_url_overrides.bookmarks&&(e={"chrome_url_overrides/bookmarks.html":t.chrome_url_overrides.bookmarks}),e)}function S(t){return!t||!t.devtools_page?void 0:t.devtools_page}function L(t){return t.options_page?t.options_page:!t||!t.options_ui||!t.options_ui.page?void 0:t.options_ui.page}function w(t){return!t||!t.page_action||!t.page_action.default_popup?void 0:t.page_action.default_popup}function $(t){if(!t||!t.sandbox||!t.sandbox.pages)return{"sandbox/page-0.html":void 0};let e=t.sandbox.pages,r={};for(let[o,n]of e.entries()){let i=n;r[`sandbox/page-${o}.html`]=i}return r}function C(t){return!t||!t.side_panel||!t.side_panel.default_path?void 0:t.side_panel.default_path}function I(t){return!t||!t.sidebar_action||!t.sidebar_action.default_panel?void 0:t.sidebar_action.default_panel}function j(t){return{"background/scripts.js":h(t),"background/service_worker.js":v(t),...y(t),"user_scripts/apiscript.js":x(t),"action/default_popup.html":A(t),"background/page.html":D(t),"browser_action/default_popup.html":M(t),...k(t),"devtools_page.html":S(t),"options_ui/page.html":L(t),"page_action/default_popup.html":w(t),...$(t),"side_panel/default_path.html":C(t),"sidebar_action/default_panel.html":I(t)}}function rt(t,e){let r=R.default.dirname(t);return Object.entries(e||{}).reduce((n,[i,a])=>{let c=R.default.relative(r,a);return n[i]=c,n},{})}function ot(t){let e=require(t);return j(e)}function E(t,e){let r=rt(t,e),o=ot(t);return{...r,...o}}function O(t,e){let r=t.getOptions(),{manifestPath:o,includeList:n}=r,i=JSON.stringify(E(o,n)),c=U.default.readFileSync(e,"utf8").replace('"__RESOLVER_MODULE_FILE_LIST__"',`${i}`);U.default.writeFileSync(e,c)}var nt={type:"object",properties:{test:{type:"string"},manifestPath:{type:"string"},includeList:{type:"object"},exclude:{type:"array"}}};function st(t){let e=this.getOptions();if((0,B.validate)(nt,e,{name:"Browser Extension Resolve Loader",baseDataPath:"options"}),new RegExp(e.test).test(this.resourcePath)){let r="resolver-module.mjs";if(this.resourcePath.includes("node_modules")||this.resourcePath.includes("dist/"))return t;let o=[];b.isUsingReact(this.rootContext)&&o.push("jsx"),b.isUsingTypeScript(this.rootContext)&&o.push("typescript");let n=F.parse(t,{sourceType:"module",plugins:o}),i=q.default.join(__dirname,r);return O(this,i),_(n,t)}return t}
